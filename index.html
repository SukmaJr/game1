<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Game Kupon ‚Äî Ready to Play</title>
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<style>
  :root{--bg:#071022;--card:#0b1220;--accent:#06b6d4;--muted:#9fb1bb}
  body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:#e6fbff;display:flex;align-items:center;justify-content:center;min-height:100vh;margin:0;padding:20px}
  .wrap{width:960px;max-width:100%;}
  .grid{display:grid;grid-template-columns:1fr 380px;gap:16px}
  .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:18px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.6)}
  h1{margin:0 0 8px;font-size:18px}
  p{color:var(--muted);font-size:13px}
  button{background:var(--accent);color:#00323a;border:0;padding:10px;border-radius:10px;font-weight:700;cursor:pointer}
  .muted{color:#7b98a2}
  .log{background:#02121a;padding:10px;border-radius:8px;margin-top:12px;font-family:monospace;font-size:13px;height:160px;overflow:auto}
  .big{font-size:28px;font-weight:700}
  .small{font-size:13px;color:var(--muted)}
  .coupon{background:#023b39;padding:8px;border-radius:8px;margin-top:10px;color:#bff3ef;font-weight:700;text-align:center}
  input,select,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #0b1220;background:#071022;color:#fff;margin-top:8px}
  .row{display:flex;gap:8px;align-items:center}
  .left{display:flex;flex-direction:column;gap:12px}
  .right{display:flex;flex-direction:column;gap:12px}
  .btn-ghost{background:transparent;border:1px solid #0b1220;color:var(--muted);padding:8px;border-radius:8px}
  .redeem-item{background:#061a1a;padding:10px;border-radius:8px}
  footer{margin-top:12px;font-size:12px;color:var(--muted)}
  @media(max-width:900px){ .grid{grid-template-columns:1fr; } }
</style>
</head>
<body>
  <div class="wrap">
    <div class="grid">
      <div class="card left">
        <h1>üéÆ Game Klik Cepat ‚Äî Dapatkan Kupon</h1>
        <p class="small">Mainkan mini-game, atau tonton iklan untuk kupon tambahan. Uang dari iklan masuk ke akun Safelinku (atau ad-network yang kamu pakai).</p>

        <div style="display:flex;gap:12px;align-items:center;margin-top:6px">
          <div>
            <div class="small">Kupon Anda</div>
            <div id="kuponCount" class="big">0</div>
          </div>
          <div style="margin-left:auto;text-align:right">
            <div class="small">Clicks Terbaik</div>
            <div id="best" class="big">0</div>
          </div>
        </div>

        <div style="margin-top:12px" class="card">
          <h2 style="margin:0 0 8px">Mini-Game: Klik Cepat (10 detik)</h2>
          <p class="small">Klik tombol sebanyak mungkin dalam 10 detik. Setelah selesai, dapat kesempatan kupon acak sesuai probabilitas.</p>
          <div class="row" style="margin-top:8px">
            <button id="startBtn">Mulai (10s)</button>
            <button id="clickBtn" class="btn-ghost" disabled>üìé Klik</button>
            <div style="margin-left:auto;text-align:right">
              <div class="small">Waktu</div>
              <div id="timer" class="big">0s</div>
            </div>
          </div>
          <div class="small" style="margin-top:8px">Skor klik: <span id="score">0</span></div>
        </div>

        <div class="card">
          <h2 style="margin:0 0 8px">Tonton Iklan (dengan Safelinku)</h2>
          <p class="small">Klik tombol di bawah ‚Üí akan membuka Safelinku. Setelah selesai iklan, pastikan Safelinku mengarahkan kembali ke halaman ini (contoh: <code>?bonus=kupon</code>), lalu klaim kupon.</p>
          <div class="row">
            <button id="watchBtn">‚ñ∂Ô∏è Tonton Iklan (Safelinku)</button>
            <button id="claimAfterAd" style="background:#2b6a4a;color:#e6fbff">Klaim setelah nonton</button>
          </div>
          <div class="small" style="margin-top:8px">Link Safelinku (ganti di kode): <span id="safelinkShow" class="muted"></span></div>
        </div>

        <div class="card">
          <h2 style="margin:0 0 8px">Riwayat Klaim</h2>
          <div id="history" class="log"></div>
        </div>

        <footer>Demo ‚Äî untuk produksi: simpan saldo kupon & redeem di server, verifikasi iklan server-side, dan hindari penyalahgunaan.</footer>
      </div>

      <div class="card right">
        <h2 style="margin:0 0 8px">Tukar Hadiah</h2>
        <div class="small">Aturan penukaran (contoh):</div>
        <ul class="small" style="text-align:left;margin:6px 0 8px 18px;color:var(--muted)">
          <li>10.000 kupon ‚Üí Panel Unli</li>
          <li>20.000 kupon ‚Üí Script Bot WA</li>
          <li>50.000 kupon ‚Üí Akun BF/GAG (acak)</li>
        </ul>

        <div class="redeem-item">
          <label class="small">Pilih Hadiah</label>
          <select id="redeemSelect">
            <option value="10000">10.000 ‚Äî Panel Unli</option>
            <option value="20000">20.000 ‚Äî Script Bot WA</option>
            <option value="50000">50000 ‚Äî Akun Game (random)</option>
          </select>
          <label class="small" style="margin-top:8px">Masukkan Kontak untuk Dikirim Hadiah</label>
          <input id="redeemContact" placeholder="No. HP / Email / WA" />
          <button id="redeemBtn" style="margin-top:10px">Kirim Permintaan Tukar</button>
          <div class="small" style="margin-top:8px;color:var(--muted)">Semua permintaan disimpan di daftar redeem (kamu sebagai admin yang memproses secara manual).</div>
        </div>

        <div style="margin-top:12px" class="card">
          <h3 style="margin:0 0 8px">Admin: Daftar Redeem</h3>
          <div id="redeemList" class="log"></div>
        </div>

        <div style="margin-top:12px" class="card">
          <h3 style="margin:0 0 8px">Pengaturan</h3>
          <label class="small">Safelinku URL</label>
          <input id="safelinkInput" placeholder="https://safelinku.com/ref/xxxx" />
          <button id="saveLink" style="margin-top:8px">Simpan Link</button>
          <div class="small" style="margin-top:8px">Minimal waktu nonton (detik):</div>
          <input id="minWait" type="number" value="6" />
          <button id="saveSettings" style="margin-top:8px">Simpan Pengaturan</button>
        </div>
      </div>
    </div>
  </div>

<script>
/* ---------------- CONFIG (ganti kalau perlu) ----------------
   Ganti SAFELINK_URL di input setelah buka halaman, atau edit di sini:
*/
const DEFAULT_SAFELINK = 'https://safelinku.com/ref/azam211010'; // <--- ganti dengan link Safelinku-mu

// ---------------- state (localStorage) ----------------
const KEY = 'game_kupon_v1';
let state = JSON.parse(localStorage.getItem(KEY) || '{}');
if (!state.coupons) state.coupons = 0;
if (!state.best) state.best = 0;
if (!state.history) state.history = [];
if (!state.redeems) state.redeems = [];
if (!state.safelink) state.safelink = DEFAULT_SAFELINK;
if (!state.minWait) state.minWait = 6; // detik
saveState();

// ---------------- helpers ----------------
function saveState(){ localStorage.setItem(KEY, JSON.stringify(state)); renderAll(); }
function logTo(elId, text){ const el = document.getElementById(elId); const d = new Date().toLocaleString(); el.prepend(document.createElement('div')).firstChild.textContent = '['+d+'] '+text; }
function renderAll(){
  document.getElementById('kuponCount').textContent = state.coupons.toLocaleString();
  document.getElementById('best').textContent = (state.best || 0);
  document.getElementById('safelinkShow').textContent = state.safelink;
  document.getElementById('safelinkInput').value = state.safelink;
  document.getElementById('minWait').value = state.minWait;
  // history
  const hist = document.getElementById('history'); hist.innerHTML = '';
  state.history.slice(0,50).forEach(h => { const row = document.createElement('div'); row.textContent = `${h.type} ‚Üí ${h.amount} pts ‚Äî ${new Date(h.at).toLocaleString()}`; hist.appendChild(row); });
  // redeem list
  const rlist = document.getElementById('redeemList'); rlist.innerHTML = '';
  state.redeems.slice().reverse().forEach(r => { const row = document.createElement('div'); row.textContent = `${r.reward} ‚Äî ${r.contact} ‚Äî ${r.status} ‚Äî ${new Date(r.at).toLocaleString()}`; rlist.appendChild(row); });
}
renderAll();

// ---------------- Game logic (klik cepat) ----------------
let timeLeft = 0, score = 0, intervalId = null;
const DURATION = 10;

const startBtn = document.getElementById('startBtn');
const clickBtn = document.getElementById('clickBtn');
const timerEl = document.getElementById('timer');
const scoreEl = document.getElementById('score');

startBtn.addEventListener('click', () => {
  if (intervalId) return;
  score = 0; timeLeft = DURATION;
  document.getElementById('score').textContent = score;
  timerEl.textContent = timeLeft + 's';
  clickBtn.disabled = false; clickBtn.classList.remove('btn-ghost'); clickBtn.style.background='transparent';
  intervalId = setInterval(() => {
    timeLeft--;
    timerEl.textContent = timeLeft + 's';
    if (timeLeft <= 0) {
      clearInterval(intervalId); intervalId = null;
      clickBtn.disabled = true; clickBtn.style.background='';
      onGameEnd();
    }
  }, 1000);
});

clickBtn.addEventListener('click', ()=> {
  score++;
  scoreEl.textContent = score;
});

function onGameEnd(){
  // reward chance after winning (you can modify to require minimum score)
  // We'll give a kupon roll after each game end
  const kupon = rollCoupon();
  if (kupon > 0){
    state.coupons += kupon;
    state.history.unshift({ type:'Game Win', amount: kupon, at: Date.now() });
    logTo('history', 'Dapat '+kupon+' kupon dari permainan (score '+score+')');
    alert('Selamat! Kamu mendapatkan '+kupon+' kupon üéâ');
    if (score > state.best){ state.best = score; }
    saveState();
  } else {
    state.history.unshift({ type:'No Reward', amount:0, at: Date.now() });
    logTo('history','Tidak mendapat kupon dari permainan (score '+score+')');
    saveState();
    alert('Wah, kali ini belum dapat kupon. Coba lagi!');
  }
}

// rollCoupon sesuai probabilitas: 1-30 (60%), 31-60 (20%), 61-100 (5%), else fallback 1
function rollCoupon(){
  const r = Math.random()*100;
  let ku = 0;
  if (r < 60){ // 60%
    ku = Math.floor(Math.random()*30) + 1; // 1-30
  } else if (r < 80){ // 20%
    ku = Math.floor(Math.random()*30) + 31; //31-60
  } else if (r < 85){ // 5%
    ku = Math.floor(Math.random()*40) + 61; //61-100
  } else {
    ku = 1; // fallback 1 kupon
  }
  return ku;
}

// ---------------- Safelinku ad flow ----------------
const watchBtn = document.getElementById('watchBtn');
const claimAfterAd = document.getElementById('claimAfterAd');

watchBtn.addEventListener('click', () => {
  // open Safelinku in new tab; record timestamp
  try {
    const w = window.open(state.safelink, '_blank');
    if (!w) { alert('Pop-up diblokir. Izinkan pop-up atau salin link: ' + state.safelink); return; }
    state.openedAt = Date.now();
    saveState();
    logTo('history', 'Membuka Safelinku untuk menonton iklan');
  } catch(e) {
    alert('Gagal membuka link. Coba manual: ' + state.safelink);
  }
});

claimAfterAd.addEventListener('click', ()=> {
  // To claim after ad, we check min wait (simple demo)
  const opened = state.openedAt || 0;
  const elapsed = (Date.now() - opened) / 1000;
  if (!opened || elapsed < state.minWait) {
    if (!confirm(`Terlihat kamu belum lama di halaman iklan (${Math.floor(elapsed)}s). Tetap klaim?`)) return;
  }
  // grant kupon via same roll
  const ku = rollCoupon();
  state.coupons += ku;
  state.history.unshift({ type:'Ad Reward', amount: ku, at: Date.now() });
  saveState();
  logTo('history', 'Dapat '+ku+' kupon dari iklan');
  alert('Kamu mendapatkan '+ku+' kupon dari menonton iklan.');
});

// auto-detect return from safelinku with ?bonus=kupon param
(function checkBonusParam(){
  const params = new URLSearchParams(window.location.search);
  if (params.get('bonus') === 'kupon'){
    // remove param so reload won't trigger again
    history.replaceState(null, '', window.location.pathname);
    // show game area and auto-focus claim
    alert('Terima kasih telah menonton iklan. Tekan "Klaim setelah nonton" untuk menerima kupon.');
  }
})();

// ---------------- Redeem ----------------
document.getElementById('redeemBtn').addEventListener('click', ()=>{
  const required = Number(document.getElementById('redeemSelect').value);
  const contact = document.getElementById('redeemContact').value.trim();
  const rewardLabel = document.getElementById('redeemSelect').options[document.getElementById('redeemSelect').selectedIndex].text;
  if (!contact) { alert('Masukkan kontak untuk dikirim hadiah.'); return; }
  if (state.coupons < required){ alert('Kupon tidak cukup.'); return; }
  // create redeem entry (status: pending)
  state.coupons -= required;
  const entry = { id: 'R-'+Math.random().toString(36).slice(2,8).toUpperCase(), reward: rewardLabel, amount: required, contact, at: Date.now(), status: 'pending' };
  state.redeems.push(entry);
  state.history.unshift({ type:'Redeem Req', amount: required, at: Date.now() });
  saveState();
  alert('Permintaan tukar dikirim. Admin harus olah manual (periksa daftar redeem).');
  logTo('redeemList', `New redeem: ${entry.id} ‚Äî ${entry.reward} ‚Äî ${entry.contact}`);
});

// ---------------- Admin actions (double click redeem item to toggle processed) ----------------
document.getElementById('redeemList').addEventListener('dblclick', (e)=>{
  // mark latest redeem as processed for demo (or locate by text)
  if (state.redeems.length === 0) return;
  const last = state.redeems[state.redeems.length - 1];
  last.status = (last.status === 'pending') ? 'done' : 'pending';
  saveState();
  alert('Toggle status redeem terakhir: ' + last.id + ' ‚Üí ' + last.status);
});

// ---------------- Settings ----------------
document.getElementById('saveLink').addEventListener('click', ()=>{
  const v = document.getElementById('safelinkInput').value.trim();
  if (!v) return alert('Masukkan Safelinku dulu.');
  state.safelink = v;
  saveState();
  alert('Safelinku disimpan.');
});
document.getElementById('saveSettings').addEventListener('click', ()=>{
  const v = Number(document.getElementById('minWait').value) || 6;
  state.minWait = v;
  saveState();
  alert('Pengaturan disimpan.');
});

// initial render call
renderAll();
</script>
</body>
</html>
